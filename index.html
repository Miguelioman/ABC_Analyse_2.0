<!doctype html>
<html lang="nl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ABC Dashboard — Excel (sheets = maanden)</title>

<!-- DataTables CSS -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
<style>
  :root { --muted:#6b7280; --card:#fff; --bg:#f6f7fb; }
  body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial; background:var(--bg); margin:18px; color:#111}
  header{display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap;margin-bottom:12px}
  h1{font-size:1.1rem;margin:0}
  .small{color:var(--muted);font-size:0.92rem}
  .card{background:var(--card); padding:14px; border-radius:10px; box-shadow:0 6px 16px rgba(12,18,30,0.04); margin-bottom:14px; border:1px solid #e6e9ef}
  .controls{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  select,input[type=text],input[type=number],button{padding:6px 8px;border-radius:6px;border:1px solid #d6d7dc}
  button.primary{background:#2563eb;color:#fff;border-color:#1e4ed8}
  .table-wrap{overflow:auto}
  .status-yes{color:green;font-weight:700}
  .status-no{color:#c02424;font-weight:700}
  canvas{max-width:100%;height:300px}
  label{font-size:0.95rem}
  @media (max-width:800px){ .controls{flex-direction:column;align-items:stretch} }
</style>
</head>
<body>

<header>
  <div>
    <h1>ABC Dashboard — Excel upload (sheets = maanden)</h1>
    <div class="small">Upload één Excel-bestand met per sheet een maandnaam (bijv. <code>02-2025</code>, <code>03-2025</code>, …). ABC: A=80%, B=15%, C=5% van cumulatieve verkochte stuks per maand.</div>
  </div>
  <div class="small">Draait volledig in de browser (client-side).</div>
</header>

<!-- Upload Excel -->
<section class="card">
  <h3>Upload Excel</h3>
  <div class="controls" style="margin-top:8px">
    <input type="file" id="excelFile" accept=".xlsx,.xls,.xlsb,.xlsm">
    <button id="uploadExcelBtn" class="primary">Upload en verwerk Excel</button>
    <button id="clearAll">Verwijder alle data</button>
    <div class="small" style="margin-left:auto">Verwachte kolommen per sheet (case-insensitive): <code>Product title</code>, <code>Product variant SKU</code> (of <code>SKU</code>), <code>Producttype</code>, <code>Starting inventory units</code>, <code>Ending inventory units</code>, <code>Inventory units sold</code>.</div>
  </div>
</section>

<!-- Geïmporteerde maanden/sheets -->
<section class="card">
  <h3>Geïmporteerde maanden (sheets)</h3>
  <div class="table-wrap" style="margin-top:8px">
    <table id="uploadedMonthsTable" class="display" style="width:100%">
      <thead><tr><th>Maand (sheet)</th><th>Bestandsnaam</th><th>Aantal regels</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>
</section>

<!-- Filters -->
<section class="card">
  <h3>Filters hoofd-overzicht</h3>
  <div class="controls" style="margin-top:8px">
    <label>Producttype:
      <select id="typeFilter"><option value="all">Alle types</option></select>
    </label>

    <label>ABC:
      <select id="abcFilter"><option value="all">Alle</option><option value="A">A</option><option value="B">B</option><option value="C">C</option></select>
    </label>

    <label>Voorraad:
      <select id="stockFilter"><option value="all">Alle</option><option value="in">Op voorraad</option><option value="out">Geen voorraad</option></select>
    </label>

    <label>Zoek (naam of SKU): <input type="text" id="globalSearch" placeholder="zoek..."></label>

    <button id="applyFilters">Toepassen</button>
    <button id="resetFilters">Reset</button>
  </div>
</section>

<!-- Hoofd-overzicht -->
<section class="card">
  <h3>Overzicht — Unieke producten (SKU)</h3>
  <div class="table-wrap" style="margin-top:8px">
    <table id="aggregatedTable" class="display" style="width:100%">
      <thead>
        <tr>
          <th>Product title</th>
          <th>SKU</th>
          <th>Producttype</th>
          <th>ABC historie (per maand)</th>
          <th>Gem. score</th>
          <th>Totaal verkocht</th>
          <th>Eindvoorraad (laatst)</th>
          <th>Op voorraad?</th>
          <th>Maanden op voorraad</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</section>

<!-- Top/Bottom -->
<section class="card">
  <h3>Top / Bottom verkopers (instelbaar)</h3>
  <div class="controls" style="margin-top:8px">
    <label>Toon top N: <input id="topN" type="number" value="10" min="1" style="width:80px"></label>
    <label>Filter producttype:
      <select id="topBottomTypeFilter"><option value="all">Alle types</option></select>
    </label>
    <label>Filter voorraad:
      <select id="rankStockFilter"><option value="all">Alle</option><option value="in">Op voorraad</option><option value="out">Geen voorraad</option></select>
    </label>
    <button id="showTop" class="primary">Toon Top</button>
    <button id="showBottom">Toon Bottom</button>
  </div>

  <div class="table-wrap" style="margin-top:12px">
    <table id="rankTable" class="display" style="width:100%">
      <thead>
        <tr>
          <th>Product</th><th>SKU</th><th>Producttype</th><th>ABC historie</th><th>Gem. score</th><th>Totaal verkocht</th><th>Maanden op voorraad</th><th>Meest actuele voorraad</th><th>Op voorraad?</th><th>Rank score</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</section>

<!-- Charts -->
<section class="card">
  <h3>Charts</h3>
  <div class="controls" style="margin-top:8px">
    <label>Maand (pie): <select id="monthSelectPie"><option value="">-- Kies maand --</option></select></label>
    <label>Filter producttype (charts):
      <select id="chartTyp
