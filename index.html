<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ABC Dashboard - Productanalyse</title>
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
<style>
  body{font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; padding:20px;}
  header{display:flex;align-items:center;gap:20px;flex-wrap:wrap}
  .card{background:#fff;border:1px solid #eee;padding:12px;border-radius:8px;box-shadow:0 1px 3px rgba(0,0,0,0.04)}
  .controls{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  #tablesWrap{margin-top:18px}
  .small{font-size:0.9rem;color:#555}
  .flex{display:flex;gap:12px;align-items:center}
  canvas{max-width:50%;height:260px}
  .inline-input{width:80px}
  .muted{color:#666}
  .status-yes{color:green;font-weight:bold}
  .status-no{color:red;font-weight:bold}
</style>
</head>
<body>
  <header>
    <h1>ABC Dashboard — Productanalyse</h1>
    <div class="small muted">Upload per maand een CSV (structuur zoals opgegeven). De app draait volledig in de browser. Plaats dit bestand als <code>index.html</code> in je GitHub repo voor Pages.</div>
  </header>

  <section class="card" aria-labelledby="uploadTitle">
    <h2 id="uploadTitle">CSV upload (per maand)</h2>
    <div class="controls">
      <input type="month" id="monthPicker">
      <input type="file" id="csvFile" accept=".csv">
      <button id="uploadBtn">Upload en verwerk</button>
      <button id="clearAll">Verwijder alle data</button>
    </div>
    <p class="small">Je kunt meerdere maanden uploaden. Data blijft in browser geheugen tot refresh.</p>
  </section>

  <section class="card" style="margin-top:12px">
    <h3>Filters & weergave (unique products op basis van SKU)</h3>
    <div class="controls">
      <label>Product (SKU): <select id="skuFilter"><option value="all">Alle</option></select></label>
      <label>Type: <select id="typeFilter"><option value="all">Alle</option><option value="sokken">Sokken</option><option value="compressiesokken">Compressiesokken</option><option value="klompen">Klompen</option><option value="mokken">Mokken</option><option value="sneakers">Sneakers</option></select></label>
      <label>ABC: <select id="abcFilter"><option value="all">Alle</option><option value="A">A</option><option value="B">B</option><option value="C">C</option></select></label>
      <label>Voorraad: <select id="stockFilter"><option value="all">Alle</option><option value="in">Op voorraad</option><option value="out">Geen voorraad</option></select></label>
      <button id="applyFilters">Toepassen</button>
      <button id="resetFilters">Reset</button>
    </div>
    <p class="small">De tabel hieronder toont unieke producten (op SKU) met ABC-historie (per geüploade maand), gemiddelde score (A=1,B=2,C=3), totaal verkocht en eindvoorraad in de meest recente maand.</p>
  </section>

  <section id="tablesWrap">
    <div class="card" style="margin-top:12px">
      <h3>Product overzicht — Unieke producten (SKU)</h3>
      <table id="aggregatedTable" class="display" style="width:100%">
        <thead>
          <tr>
            <th>Product title</th>
            <th>SKU</th>
            <th>Type</th>
            <th>ABC historie (per maand)</th>
            <th>Gem. score</th>
            <th>Totaal verkocht</th>
            <th>Eindvoorraad (laatst)</th>
            <th>Op voorraad?</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="card" style="margin-top:12px">
      <h3>Product overzicht (per maand — detail)</h3>
      <table id="productsTable" class="display" style="width:100%">
        <thead>
          <tr>
            <th>Product title</th>
            <th>SKU</th>
            <th>Categorie</th>
            <th>Maand</th>
            <th>Start voorraad</th>
            <th>Eind voorraad</th>
            <th>Verkocht (units)</th>
            <th>ABC</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="card" style="margin-top:12px">
      <h3>Top / Bottom verkopers</h3>
      <div class="controls">
        <label>Toon top N: <input id="topN" class="inline-input" type="number" value="10" min="1"></label>
        <button id="showTop">Top aantallen</button>
        <button id="showTopRevenue">Top omzet</button>
        <button id="showBottom">Slechtst aantallen</button>
        <button id="showBottomRevenue">Slechtst omzet</button>
      </div>
      <table id="topTable" class="display" style="width:100%"><thead><tr><th>Product</th><th>SKU</th><th>Totale units</th><th>Totale omzet</th></tr></thead><tbody></tbody></table>
    </div>

    <div class="card" style="margin-top:12px">
      <h3>Specifieke analyses</h3>
      <div class="controls">
        <button id="aNoStock">A-producten zonder voorraad (laatste maand)</button>
        <button id="cWithStock">C-producten met voorraad (schatting dagen voorraad)</button>
      </div>
      <table id="analysisTable" class="display" style="width:100%"><thead><tr><th>Product</th><th>SKU</th><th>ABC (laatste)</th><th>Eind voorraad (laatst)</th><th>Extra</th></tr></thead><tbody></tbody></table>
    </div>

    <div class="card" style="margin-top:12px">
      <h3>Visualisaties</h3>
      <div class="controls">
        <label>Maand voor piechart: <select id="monthSelectPie"></select></label>
        <button id="drawPie">Toon piechart</button>
        <label>Trend (A/B/C % over tijd): <select id="trendMode"><option value="count">% producten (aantal)</option><option value="revenue">% op basis van omzet</option></select></label>
        <button id="drawTrend">Toon trend</button>
      </div>
      <div style="margin-top:12px; display:flex; gap:12px; flex-wrap:wrap">
        <canvas id="pieCanvas" class="chart-canvas"></canvas>
        <canvas id="trendCanvas" class="chart-canvas"></canvas>
      </div>
    </div>

    <div class="card" style="margin-top:12px">
      <h3>Product historie & voorraadverloop</h3>
      <div class="controls">
        <label>Zoek product (naam of SKU, komma-gescheiden): <input id="histSearch" placeholder="naam of SKU"></label>
        <button id="showHistory">Toon historie</button>
      </div>
      <div id="historyResult"></div>
      <canvas id="historyChart"></canvas>
    </div>

  </section>

  <!-- scripts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <script>
  // --- Config & helpers ---
  const PRICE_BY_CATEGORY = { sokken:10.95, compressiesokken:29.95, klompen:79.99, mokken:14.99, sneakers:99.99 };
  function mapCategory(title){ const t=(title||'').toLowerCase(); if(t.includes('compressie')) return 'compressiesokken'; if(t.includes('sok')) return 'sokken'; if(t.includes('klomp')) return 'klompen'; if(t.includes('mok')) return 'mokken'; if(t.includes('sneak')) return 'sneakers'; return 'overig'; }
  function n(v){const x=parseFloat(v); return isNaN(x)?0:x}
  function abcScore(letter){ if(letter==='A') return 1; if(letter==='B') return 2; if(letter==='C') return 3; return null }

  // Data stores
  const monthsData = {}; // raw rows per month
  const computed = { byMonth:{} }; // grouped + ABC per month
  let aggregated = {}; // aggregated per SKU across months

  // DataTables refs
  let aggregatedTable = null, productsTable=null, topTable=null, analysisTable=null;
  let pieChart=null, trendChart=null, historyChart=null;

  // --- CSV upload ---
  document.getElementById('uploadBtn').addEventListener('click', ()=>{
    const file = document.getElementById('csvFile').files[0];
    const month = document.getElementById('monthPicker').value;
    if(!file){alert('Selecteer CSV bestand'); return}
    if(!month){alert('Selecteer een maand (YYYY-MM)'); return}

    Papa.parse(file, {header:true, skipEmptyLines:true, complete: (res)=>{
      const raw = res.data;
      const rows = raw.map(r=>({
        product_title: r['Product title']||r['Product Title']||r['product title']||'',
        variant_title: r['Product variant title']||r['Product variant title']||'',
        sku: r['Product variant SKU']||r['Product variant sku']||r['SKU']||r['sku']||'',
        start_inv: n(r['Starting inventory units']),
        end_inv: n(r['Ending inventory units']),
        sold: n(r['Inventory units sold']),
        category: mapCategory(r['Product title']||''),
      })).filter(r=> r.start_inv>0);

      monthsData[month] = rows;
      recomputeAll();
      refreshMonthSelects();
      updateFilters();
      alert('Upload succesvol: '+rows.length+' regels voor '+month);
    }});
  });

  document.getElementById('clearAll').addEventListener('click', ()=>{ if(!confirm('Verwijder alle data?')) return; for(const k in monthsData) delete monthsData[k]; recomputeAll(); updateFilters(); });

  // --- compute ABC per month (on units sold) ---
  function computeABCForMonthUnits(month){
    const rows = monthsData[month]||[];
    // group by product+sku
    const grouped = {};
    rows.forEach(r=>{
      const key = r.product_title+'||'+r.sku;
      if(!grouped[key]) grouped[key] = {product_title:r.product_title, sku:r.sku, category:r.category, start_inv:r.start_inv, end_inv:r.end_inv, sold:r.sold};
      else{ grouped[key].start_inv += r.start_inv; grouped[key].end_inv += r.end_inv; grouped[key].sold += r.sold; }
    });
    const arr = Object.values(grouped);
    arr.sort((a,b)=> b.sold - a.sold);
    const totalSold = arr.reduce((s,x)=>s+x.sold,0)||1;
    let cum = 0;
    arr.forEach(it=>{ cum += it.sold; const pct = (cum/totalSold)*100; if(pct<=80) it.ABC='A'; else if(pct<=95) it.ABC='B'; else it.ABC='C'; });
    return arr;
  }

  function recomputeAll(){
    // compute per month
    computed.byMonth = {};
    Object.keys(monthsData).sort().forEach(m=>{ computed.byMonth[m] = computeABCForMonthUnits(m); });
    // build aggregated
    buildAggregated();
    rebuildTables();
  }

  function buildAggregated(){
    aggregated = {};
    const months = Object.keys(computed.byMonth).sort();
    // ensure chronological order
    months.forEach(m=>{
      computed.byMonth[m].forEach(it=>{
        const sku = it.sku;
        if(!aggregated[sku]) aggregated[sku] = { name: it.product_title, sku: sku, type: it.category, historyMap:{}, totalSold:0 };
        aggregated[sku].historyMap[m] = it.ABC;
        aggregated[sku].totalSold += it.sold;
      });
    });
    // build history array aligned to months, compute avgScore and latest end_inv
    const lastMonth = months.length? months[months.length-1]: null;
    Object.keys(aggregated).forEach(sku=>{
      const prod = aggregated[sku];
      prod.history = months.map(m=> prod.historyMap[m] ? prod.historyMap[m] : '-');
      const scores = prod.history.filter(c=> c==='A'||c==='B'||c==='C').map(c=> abcScore(c));
      prod.avgScore = scores.length? (scores.reduce((a,b)=>a+b,0)/scores.length).toFixed(2) : '';
      // latest end inventory from lastMonth if available
      if(lastMonth){ const found = (computed.byMonth[lastMonth]||[]).find(x=>x.sku===sku); prod.latest_end = found? found.end_inv: 0; prod.in_stock = prod.latest_end>0; } else { prod.latest_end = 0; prod.in_stock=false; }
      // revenue (for top by revenue)
      const price = PRICE_BY_CATEGORY[prod.type] || 0;
      prod.totalRevenue = prod.totalSold * price;
    });
  }

  // --- UI helpers & tables ---
  function refreshMonthSelects(){
    const sel = document.getElementById('monthSelectPie'); sel.innerHTML='';
    Object.keys(monthsData).sort().forEach(m=>{ const opt = document.createElement('option'); opt.value=m; opt.text = m; sel.appendChild(opt); });
  }

  function updateFilters(){
    // sku filter
    const skuSel = document.getElementById('skuFilter'); skuSel.innerHTML = '<option value="all">Alle</option>';
    Object.values(aggregated).forEach(p=>{ const opt = document.createElement('option'); opt.value=p.sku; opt.text = `${p.name} (${p.sku})`; skuSel.appendChild(opt); });
    // ensure productsTable empty
    rebuildTables();
  }

  document.getElementById('applyFilters').addEventListener('click', ()=>rebuildTables());
  document.getElementById('resetFilters').addEventListener('click', ()=>{ document.getElementById('skuFilter').value='all'; document.getElementById('typeFilter').value='all'; document.getElementById('abcFilter').value='all'; document.getElementById('stockFilter').value='all'; rebuildTables(); });

  function rebuildTables(){
    rebuildAggregatedTable();
    rebuildProductsTable();
    if(topTable) topTable.clear().draw();
    if(analysisTable) analysisTable.clear().draw();
  }

  function rebuildAggregatedTable(){
    const tbody = $('#aggregatedTable tbody'); if($.fn.dataTable.isDataTable('#aggregatedTable')){ aggregatedTable.destroy(); $('#aggregatedTable tbody').empty(); } else { tbody.empty(); }
    const skuFilter = document.getElementById('skuFilter').value;
    const typeFilter = document.getElementById('typeFilter').value;
    const abcFilter = document.getElementById('abcFilter').value;
    const stockFilter = document.getElementById('stockFilter').value;

    Object.values(aggregated).forEach(p=>{
      if(skuFilter!=='all' && p.sku !== skuFilter) return;
      if(typeFilter!=='all' && p.type !== typeFilter) return;
      if(abcFilter!=='all'){
        // check if latest ABC or any history include abcFilter
        const latest = p.history.length? p.history[p.history.length-1] : '-';
        if(!p.history.includes(abcFilter) && latest!==abcFilter) return;
      }
      if(stockFilter==='in' && !p.in_stock) return;
      if(stockFilter==='out' && p.in_stock) return;
      const inStockText = p.in_stock? '<span class="status-yes">Ja</span>' : '<span class="status-no">Nee</span>';
      const row = `<tr>
        <td>${p.name}</td>
        <td>${p.sku}</td>
        <td>${p.type}</td>
        <td>${p.history.join(', ')}</td>
        <td>${p.avgScore}</td>
        <td>${p.totalSold}</td>
        <td>${p.latest_end}</td>
        <td>${inStockText}</td>
      </tr>`;
      $('#aggregatedTable tbody').append(row);
    });
    aggregatedTable = $('#aggregatedTable').DataTable({order:[[0,'asc']]});
  }

  function rebuildProductsTable(){
    if($.fn.dataTable.isDataTable('#productsTable')){ productsTable.destroy(); $('#productsTable tbody').empty(); }
    Object.keys(computed.byMonth).sort().forEach(m=>{
      computed.byMonth[m].forEach(item=>{
        $('#productsTable tbody').append(`<tr>
          <td>${item.product_title}</td>
          <td>${item.sku}</td>
          <td>${item.category}</td>
          <td>${m}</td>
          <td>${item.start_inv}</td>
          <td>${item.end_inv}</td>
          <td>${item.sold}</td>
          <td>${item.ABC}</td>
        </tr>`);
      });
    });
    productsTable = $('#productsTable').DataTable({order:[[0,'asc']]});
  }

  // --- Top / bottom lists ---
  function aggregateAll(){ return Object.values(aggregated).map(p=>({product:p.name, sku:p.sku, units:p.totalSold, revenue:p.totalRevenue})); }
  $('#showTop').on('click', ()=>{ const N = parseInt($('#topN').val())||10; const data = aggregateAll().sort((a,b)=>b.units-a.units).slice(0,N); renderTopTable(data); });
  $('#showTopRevenue').on('click', ()=>{ const N = parseInt($('#topN').val())||10; const data = aggregateAll().sort((a,b)=>b.revenue-a.revenue).slice(0,N); renderTopTable(data); });
  $('#showBottom').on('click', ()=>{ const N = parseInt($('#topN').val())||10; const data = aggregateAll().sort((a,b)=>a.units-b.units).slice(0,N); renderTopTable(data); });
  $('#showBottomRevenue').on('click', ()=>{ const N = parseInt($('#topN').val())||10; const data = aggregateAll().sort((a,b)=>a.revenue-b.revenue).slice(0,N); renderTopTable(data); });

  function renderTopTable(rows){ if($.fn.dataTable.isDataTable('#topTable')){ topTable.destroy(); $('#topTable tbody').empty(); } rows.forEach(r=>$('#topTable tbody').append(`<tr><td>${r.product}</td><td>${r.sku}</td><td>${r.units}</td><td>${r.revenue.toFixed(2)}</td></tr>`)); topTable = $('#topTable').DataTable(); }

  // --- Specific analyses ---
  $('#aNoStock').on('click', ()=>{
    if(Object.keys(computed.byMonth).length===0){ alert('Geen data'); return; }
    const months = Object.keys(computed.byMonth).sort(); const last = months[months.length-1];
    const arr = computed.byMonth[last]||[]; const rows = arr.filter(x=>x.ABC==='A' && x.end_inv===0).map(x=>({product:x.product_title, sku:x.sku, ABC:x.ABC, end:x.end_inv, extra:'Geen voorraad'}));
    if($.fn.dataTable.isDataTable('#analysisTable')){ analysisTable.destroy(); $('#analysisTable tbody').empty(); }
    rows.forEach(r=>$('#analysisTable tbody').append(`<tr><td>${r.product}</td><td>${r.sku}</td><td>${r.ABC}</td><td>${r.end}</td><td>${r.extra}</td></tr>`));
    analysisTable = $('#analysisTable').DataTable();
  });

  $('#cWithStock').on('click', ()=>{
    const months = Object.keys(computed.byMonth).sort(); if(months.length===0){ alert('Geen data'); return; }
    const last = months[months.length-1]; const arrLast = computed.byMonth[last]||[]; const rows = [];
    arrLast.forEach(item=>{
      if(item.ABC==='C' && item.end_inv>0){
        let totalSold=0, monthsCount=0;
        months.forEach(m=>{ const found = (computed.byMonth[m]||[]).find(x=>x.sku===item.sku); if(found){ totalSold += found.sold; monthsCount++; } });
        const avgMonthly = monthsCount>0 ? totalSold/monthsCount : 0; const avgDaily = avgMonthly/30; const daysLeft = avgDaily>0 ? Math.round(item.end_inv/avgDaily) : 'N/A';
        rows.push({product:item.product_title, sku:item.sku, ABC:item.ABC, end:item.end_inv, daysLeft});
      }
    });
    rows.sort((a,b)=> (b.daysLeft==='N/A'? -1 : b.daysLeft) - (a.daysLeft==='N/A'? -1 : a.daysLeft));
    if($.fn.dataTable.isDataTable('#analysisTable')){ analysisTable.destroy(); $('#analysisTable tbody').empty(); }
    rows.forEach(r=>$('#analysisTable tbody').append(`<tr><td>${r.product}</td><td>${r.sku}</td><td>${r.ABC}</td><td>${r.end}</td><td>${r.daysLeft}</td></tr>`));
    analysisTable = $('#analysisTable').DataTable();
  });

  // --- Charts ---
  document.getElementById('drawPie').addEventListener('click', ()=>{
    const month = document.getElementById('monthSelectPie').value; if(!month){ alert('Selecteer maand'); return; }
    const arr = computed.byMonth[month]||[]; const counts = {A:0,B:0,C:0}; arr.forEach(x=> counts[x.ABC] = (counts[x.ABC]||0) + 1);
    if(pieChart) pieChart.destroy(); const ctx = document.getElementById('pieCanvas').getContext('2d'); pieChart = new Chart(ctx, { type:'pie', data:{ labels:['A','B','C'], datasets:[{ data:[counts.A,counts.B,counts.C], backgroundColor:['#2ecc71','#f39c12','#e74c3c'] }] }, options:{ plugins:{title:{display:true,text:'Verdeling ABC ('+month+')'}}});
  });

  document.getElementById('drawTrend').addEventListener('click', ()=>{
    const mode = document.getElementById('trendMode').value; const months = Object.keys(computed.byMonth).sort(); if(months.length===0){ alert('Geen data'); return; }
    const series = {A:[],B:[],C:[]}; months.forEach(m=>{ const arr = computed.byMonth[m]||[]; if(mode==='count'){ const total = arr.length||1; series.A.push((arr.filter(x=>x.ABC==='A').length/total)*100); series.B.push((arr.filter(x=>x.ABC==='B').length/total)*100); series.C.push((arr.filter(x=>x.ABC==='C').length/total)*100); } else { const revTotal = arr.reduce((s,x)=>s+( (PRICE_BY_CATEGORY[x.category]||0)*x.sold ),0)||1; const revA = arr.filter(x=>x.ABC==='A').reduce((s,x)=>s+((PRICE_BY_CATEGORY[x.category]||0)*x.sold),0); const revB = arr.filter(x=>x.ABC==='B').reduce((s,x)=>s+((PRICE_BY_CATEGORY[x.category]||0)*x.sold),0); const revC = arr.filter(x=>x.ABC==='C').reduce((s,x)=>s+((PRICE_BY_CATEGORY[x.category]||0)*x.sold),0); series.A.push((revA/revTotal)*100); series.B.push((revB/revTotal)*100); series.C.push((revC/revTotal)*100); } });
    if(trendChart) trendChart.destroy(); const ctx = document.getElementById('trendCanvas').getContext('2d'); trendChart = new Chart(ctx, { type:'line', data:{ labels:months, datasets:[ {label:'A %', data:series.A, borderColor:'#2ecc71', tension:0.3}, {label:'B %', data:series.B, borderColor:'#f39c12', tension:0.3}, {label:'C %', data:series.C, borderColor:'#e74c3c', tension:0.3} ] }, options:{ plugins:{title:{display:true,text:'Trend ABC % over tijd ('+mode+')'}}});
  });

  // --- History view ---
  document.getElementById('showHistory').addEventListener('click', ()=>{
    const q = document.getElementById('histSearch').value.trim().toLowerCase(); if(!q){ alert('Voer een productnaam of SKU in'); return; }
    const tokens = q.split(',').map(s=>s.trim()).filter(Boolean);
    const months = Object.keys(computed.byMonth).sort(); const matched = {};
    months.forEach(m=>{ computed.byMonth[m].forEach(it=>{ const key = it.product_title + '||' + it.sku; const title = it.product_title.toLowerCase(); const sku = it.sku.toLowerCase(); const match = tokens.some(t=> title.includes(t) || sku.includes(t)); if(match){ if(!matched[key]) matched[key]={product:it.product_title, sku:it.sku, months:{}}; matched[key].months[m] = it; } }); });
    renderHistory(matched, months);
  });

  function renderHistory(matched, months){ const container = document.getElementById('historyResult'); container.innerHTML=''; const keys = Object.keys(matched); if(keys.length===0){ container.innerHTML='<p>Geen producten gevonden</p>'; return; }
    let html = '<table style="width:100%;border-collapse:collapse"><thead><tr><th>Product</th><th>SKU</th>'+ months.map(m=>`<th>${m}</th>`).join('') + '<th>Gem. score</th></tr></thead><tbody>';
    keys.forEach(k=>{ const p = matched[k]; const scores=[]; html+='<tr><td>'+p.product+'</td><td>'+p.sku+'</td>'; months.forEach(m=>{ const it = p.months[m]; if(it){ html+=`<td>${it.ABC}</td>`; scores.push(abcScore(it.ABC)); } else html+='<td>-</td>'; }); const avg = scores.length? (scores.reduce((a,b)=>a+b,0)/scores.length).toFixed(2) : '-'; html += `<td>${avg}</td></tr>`; }); html += '</tbody></table>'; container.innerHTML = html;
    // inventory chart for first matched product
    const first = matched[keys[0]]; const invLabels = months.slice(); const startData = months.map(m=> first.months[m]? first.months[m].start_inv : null); const endData = months.map(m=> first.months[m]? first.months[m].end_inv : null);
    if(historyChart) historyChart.destroy(); const ctx = document.getElementById('historyChart').getContext('2d'); historyChart = new Chart(ctx, { type:'bar', data:{ labels:invLabels, datasets:[{type:'line', label:'Start voorraad', data:startData, tension:0.3},{type:'bar', label:'Eind voorraad', data:endData}] }, options:{ plugins:{title:{display:true,text:'Voorraadverloop: '+first.product}} } });
  }

  // --- init ---
  $(document).ready(()=>{ aggregatedTable = $('#aggregatedTable').DataTable(); productsTable = $('#productsTable').DataTable(); topTable = $('#topTable').DataTable(); analysisTable = $('#analysisTable').DataTable(); });

  // expose for debug
  window._monthsData = monthsData; window._computed = computed; window._aggregated = aggregated;
  </script>
</body>
</html>
